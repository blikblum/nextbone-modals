{"version":3,"file":"nextbone-modals.js","sources":["../src/service.js","../src/bootstrap-views.js","../src/bootstrap.js"],"sourcesContent":["import { Events } from 'nextbone'\r\nimport { defineAsyncMethods } from 'nextbone/service'\r\nimport { last, without } from 'underscore'\r\n\r\nconst cancelHandlerMap = new WeakMap()\r\n\r\n/**\r\n * @class Modals\r\n */\r\nexport class Modals extends Events {\r\n  /**\r\n   * @constructs Modals\r\n   */\r\n  constructor (channelName) {\r\n    super(channelName)\r\n    this.views = []\r\n  }\r\n\r\n  createElement (type) {\r\n    return document.createElement(`nextbone-modal-${type}`)\r\n  }\r\n\r\n  getCancelHandler (view) {\r\n    return cancelHandlerMap.get(view)\r\n  }\r\n\r\n  /**\r\n   * @method open\r\n   * @param {HTMLElement} [view]\r\n   * @returns {Promise}\r\n   */\r\n  open (view, options) {\r\n    let previousView\r\n    view.options = options\r\n    return Promise.resolve().then(() => {\r\n      this.trigger('before:open', view, options)\r\n      this._isOpen = true\r\n\r\n      previousView = last(this.views)\r\n      this.views.push(view)\r\n\r\n      return this.render(view, options)\r\n    }).then(() => {\r\n      if (previousView) {\r\n        return this.animateSwap(previousView, view, options)\r\n      } else {\r\n        return this.animateIn(view, options)\r\n      }\r\n    }).then(() => {\r\n      this.trigger('open', view, options)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @method close\r\n   * @param {HTMLElement} [view]\r\n   * @returns {Promise}\r\n   */\r\n  close (view, options) {\r\n    let previousView\r\n    let views\r\n\r\n    return Promise.resolve().then(() => {\r\n      if (view) {\r\n        this.trigger('before:close', view, options)\r\n      } else {\r\n        this.views.map(view => this.trigger('before:close', view, options))\r\n      }\r\n\r\n      this._isOpen = false\r\n\r\n      if (view) {\r\n        views = this.views = without(this.views, view)\r\n      } else {\r\n        views = this.views\r\n        this.views = []\r\n      }\r\n\r\n      previousView = last(views)\r\n\r\n      if (view && previousView) {\r\n        return this.animateSwap(view, previousView, options)\r\n      } else if (view) {\r\n        return this.animateOut(view, options)\r\n      } else if (previousView) {\r\n        return this.animateOut(previousView, options)\r\n      }\r\n    }).then(() => {\r\n      if (view) {\r\n        return this.remove(view, options)\r\n      } else {\r\n        return Promise.all(views.map(view => this.remove(view, options)))\r\n      }\r\n    }).then(() => {\r\n      if (view) {\r\n        this.trigger('close', view, options)\r\n      } else {\r\n        views.map(view => this.trigger('close', view, options))\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @method alert\r\n   * @param {Object} [options]\r\n   * @returns {Promise}\r\n   */\r\n  alert (options = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = this.createElement('alert')\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:alert', view, options)\r\n\r\n      let cancel = () => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('alert', null, view, options))\r\n          .then(() => resolve(), reject)\r\n      }\r\n\r\n      cancelHandlerMap.set(view, cancel)\r\n\r\n      view.on('confirm cancel', cancel)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @method confirm\r\n   * @param {Object} [options]\r\n   * @returns {Promise}\r\n   */\r\n  confirm (options = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = this.createElement('confirm')\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:confirm', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('confirm', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      let cancel = () => close(false)\r\n\r\n      cancelHandlerMap.set(view, cancel)\r\n\r\n      view.on({\r\n        confirm: () => close(true),\r\n        cancel\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @method prompt\r\n   * @returns {Promise}\r\n   */\r\n  prompt (options = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = this.createElement('prompt')\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:prompt', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('prompt', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      let cancel = () => close()\r\n\r\n      cancelHandlerMap.set(view, cancel)\r\n\r\n      view.on({\r\n        submit: text => close(text),\r\n        cancel\r\n      })\r\n    })\r\n  }\r\n\r\n  dialog (view, options = {}) {\r\n    if (!view) {\r\n      throw new Error('ModalService: no view option passed to dialog')\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:dialog', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('dialog', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      let cancel = () => close()\r\n\r\n      cancelHandlerMap.set(view, cancel)\r\n\r\n      view.on({\r\n        submit: data => close(data),\r\n        cancel\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @method isOpen\r\n   * @returns {Boolean}\r\n   */\r\n  isOpen () {\r\n    return !!this._isOpen\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @method render\r\n   */\r\n  render () {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @method remove\r\n   */\r\n  remove () {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateIn\r\n   */\r\n  animateIn () {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateSwap\r\n   */\r\n  animateSwap () {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateOut\r\n   */\r\n  animateOut () {}\r\n}\r\n\r\n\r\ndefineAsyncMethods(Modals, ['open', 'close', 'confirm', 'prompt', 'dialog'])\r\n","import { Events } from 'nextbone'\r\n\r\nconst defaultCaptions = {\r\n  ok: 'OK',\r\n  cancel: 'Cancel',\r\n  yes: 'Yes',\r\n  no: 'No'\r\n}\r\n\r\nclass BaseModal extends HTMLElement {\r\n  confirmClick () {\r\n    this.trigger('confirm')\r\n  }\r\n\r\n  submit (e) {\r\n    e.preventDefault()\r\n    const val = this.querySelector('input').value\r\n    this.trigger('submit', val)\r\n  }\r\n\r\n  bindEvent (selector, event, listener) {\r\n    const el = this.querySelector(selector)\r\n    if (el) el.addEventListener(event, listener.bind(this))\r\n  }\r\n\r\n  connectedCallback () {\r\n    this.innerHTML = this.render(this.options)\r\n    this.bindEvent('.btn-primary', 'click', this.confirmClick)        \r\n    this.bindEvent('form', 'submit', this.submit)\r\n  }\r\n}\r\n\r\nEvents.extend(BaseModal.prototype)\r\n\r\nclass AlertView extends BaseModal {\r\n  render (data) {\r\n    return `\r\n    <div class=\"modal-header\">\r\n      <h5 class=\"modal-title\">${data.title}</h5>\r\n      <button type=\"button\" class=\"close\" aria-hidden=\"true\" data-dismiss=\"modal\">&times;</button>      \r\n    </div>\r\n\r\n    <div class=\"modal-body\">\r\n      <p>${data.text}</p>\r\n    </div>\r\n\r\n    <div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-primary\">${data.ok || defaultCaptions.ok}</button>\r\n    </div>\r\n    `\r\n  }\r\n}\r\n\r\nclass PromptView extends BaseModal {\r\n  render (data) {\r\n    return `\r\n    <form>\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\">${data.title}</h5>\r\n        <button type=\"button\" class=\"close\" aria-hidden=\"true\" data-dismiss=\"modal\">&times;</button>      \r\n      </div>\r\n\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"modal__input--prompt\">${data.text}</label>\r\n          <input id=\"modal__input--prompt\" class=\"form-control\" type=\"text\" value=\"${data.value || ''}\">\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">${data.cancel || defaultCaptions.cancel}</button>\r\n        <button type=\"submit\" class=\"btn btn-primary\">${data.ok || defaultCaptions.ok}</button>\r\n      </div>\r\n    </form>\r\n    `\r\n  }\r\n}\r\n\r\nclass ConfirmView extends BaseModal {\r\n  render (data) {\r\n    return `\r\n    <div class=\"modal-header\">\r\n      <h5 class=\"modal-title\">${data.title}</h5>\r\n      <button type=\"button\" class=\"close\" aria-hidden=\"true\" data-dismiss=\"modal\">&times;</button>      \r\n    </div>\r\n    \r\n    <div class=\"modal-body\">\r\n      <p>${data.text}</p>\r\n    </div>\r\n    \r\n    <div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">${data.no || defaultCaptions.no}</button>\r\n      <button type=\"button\" class=\"btn btn-primary\">${data.yes || defaultCaptions.yes}</button>\r\n    </div>      \r\n    `\r\n  }\r\n}\r\n\r\nexport { AlertView, ConfirmView, PromptView, defaultCaptions }\r\n","import $ from 'jquery'\r\nimport { last } from 'underscore'\r\nimport { Region } from 'nextbone/dom-utils'\r\nimport { Modals } from './service'\r\nimport { AlertView, PromptView, ConfirmView, defaultCaptions } from './bootstrap-views'\r\n\r\nconst layoutTemplate = `\r\n<div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\">\r\n  <div class=\"modal-dialog\">\r\n  </div>\r\n</div>\r\n`\r\n\r\nconst elementClasses = {\r\n  alert: AlertView,\r\n  prompt: PromptView,\r\n  confirm: ConfirmView\r\n}\r\n\r\nexport class BootstrapModals extends Modals {\r\n  static setCaptions (captions = {}) {\r\n    Object.assign(defaultCaptions, captions)\r\n  }\r\n\r\n  setup (options = {}) {\r\n    this.container = options.container\r\n  }\r\n\r\n  createElement (type) {\r\n    const name = `bootstrap-modal-${type}`\r\n    if (!customElements.get(name)) {\r\n      customElements.define(name, elementClasses[type])\r\n    }\r\n    return document.createElement(name)\r\n  }\r\n\r\n  start () {\r\n    if (!this.container) {\r\n      throw new Error('Bootstrap Modals: container option is not defined')\r\n    }\r\n\r\n    const $container = $(this.container)\r\n    if (!$container.length) {\r\n      throw new Error(`Bootstrap Modals: unable to find container element (${this.container})`)\r\n    }\r\n\r\n    $container.html(layoutTemplate)\r\n\r\n    const $layout = this.$layout = $container.children().eq(0)\r\n\r\n    $layout.modal({\r\n      show: false,\r\n      backdrop: 'static'\r\n    })\r\n\r\n    $layout.on({\r\n      'shown.bs.modal': (e) => this.trigger('modal:show', e),\r\n      'hidden.bs.modal': (e) => { \r\n        // closed by bootstrap handler\r\n        if (this.isOpen()) {\r\n          // todo: get view from dom tree        \r\n          const view = last(this.views)\r\n          const cancel = this.getCancelHandler(view)\r\n          return cancel()\r\n        }\r\n        this.trigger('modal:hide', e)\r\n      }  \r\n    })\r\n\r\n    const $dialog = $layout.find('.modal-dialog')\r\n\r\n    this.contentRegion = new Region($dialog[0])\r\n\r\n    this.on('before:open', (view, options) => {\r\n      const {size, scrollable, centered} = options\r\n      let dialogClasses = ''\r\n      if (size) {\r\n        dialogClasses += ` modal-${size}`\r\n      }\r\n      if (scrollable) {\r\n        dialogClasses += ` modal-dialog-scrollable`\r\n      }\r\n      if (centered) {\r\n        dialogClasses += ` modal-dialog-centered`\r\n      }\r\n\r\n      if (dialogClasses) {\r\n        $dialog.addClass(dialogClasses)\r\n      }\r\n      this.__dialogClasses = dialogClasses\r\n    })\r\n\r\n    this.on('close', () => {\r\n      $dialog.removeClass(this.__dialogClasses)\r\n    })\r\n  }\r\n\r\n  render (view) {\r\n    view.classList.add('modal-content')\r\n    this.contentRegion.show(view)\r\n  }\r\n\r\n  remove () {\r\n    this.contentRegion.empty()\r\n  }\r\n\r\n  animateIn () {\r\n    return new Promise(resolve => {\r\n      this.once('modal:show', resolve)\r\n      this.$layout.modal('show')\r\n    })\r\n  }\r\n\r\n  animateOut () {\r\n    // if modal already hidden, i.e., closed by bootstrap handler, does nothing\r\n    if (this.$layout.hasClass('show')) return new Promise(resolve => {\r\n      this.once('modal:hide', resolve)\r\n      this.$layout.modal('hide')\r\n    })\r\n  }\r\n}\r\n"],"names":["cancelHandlerMap","WeakMap","Modals","Events","constructor","channelName","views","createElement","type","document","getCancelHandler","view","get","open","options","previousView","Promise","resolve","then","trigger","_isOpen","last","push","render","animateSwap","animateIn","close","map","without","animateOut","remove","all","alert","reject","promise","cancel","set","on","confirm","result","prompt","submit","text","dialog","Error","data","isOpen","defineAsyncMethods","defaultCaptions","ok","yes","no","BaseModal","HTMLElement","confirmClick","e","preventDefault","val","querySelector","value","bindEvent","selector","event","listener","el","addEventListener","bind","connectedCallback","innerHTML","extend","prototype","AlertView","title","PromptView","ConfirmView","layoutTemplate","elementClasses","BootstrapModals","setCaptions","captions","Object","assign","setup","container","name","customElements","define","start","$container","$","length","html","$layout","children","eq","modal","show","backdrop","$dialog","find","contentRegion","Region","size","scrollable","centered","dialogClasses","addClass","__dialogClasses","removeClass","classList","add","empty","once","hasClass"],"mappings":"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"}